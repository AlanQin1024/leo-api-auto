webpackJsonp([7],{F83Z:function(t,e){},Tr1n:function(t,e,r){"use strict";e.b=function(t,e){return Object(i.a)({url:"/api/project/"+t+"/mailList",params:e,method:"GET"})},e.a=function(t,e,r){return Object(i.a)({url:"/api/project/"+t+"/addMail",method:"POST",headers:r,data:e})},e.c=function(t,e,r,s){return Object(i.a)({url:"/api/project/"+t+"/updateMail/"+e,method:"POST",headers:s,data:r})};var i=r("cKc3")},fTqM:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r("woOf"),s=r.n(i),a=r("cKc3");var o=r("FrIa"),n=r("pR/e"),l=r("Tr1n"),m={name:"CronJobList",data:function(){var t=this;return{filters:{name:""},testSuites:[],mailList:[],TriggerTypes:[{name:"触发间隔",value:"interval"},{name:"具体日期",value:"date"}],size:10,skip:0,sortBy:"createAt",order:"descending",pageNum:1,totalNum:0,selects:[],delLoading:!1,disDel:!0,TestStatus:!1,listLoading:!1,statusChangeLoading:!1,cronJobs:[],testEnvs:[],titleMap:{add:"新增定时任务",edit:"编辑定时任务"},dialogStatus:"",formVisible:!1,editLoading:!1,formRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],testSuiteIdList:[{required:!0,message:"请选择测试用例组",trigger:"blur"}],testEnvId:[{required:!0,message:"请选择测试环境",trigger:"blur"}],alarmMailList:[{required:!1,message:"请选择告警邮箱",trigger:"blur"}],triggerType:[{required:!0,message:"请选择触发类型",trigger:"blur"}],interval:[{required:!1,message:"请输入触发间隔",trigger:"blur"},{validator:function(e,r,i){""!==r&&null!==r&&void 0!==r?r>=60?i():(i(new Error("请输入大于或等于一分钟的触发间隔！")),t.$message.warning({message:"请输入大于或等于一分钟的触发间隔！",center:!0})):i()},trigger:"blur"}],runDate:[{required:!1,message:"请输入触发时间",trigger:"blur"}],description:[{required:!1,message:"请输入版本号",trigger:"blur"},{max:1024,message:"不能超过1024个字符",trigger:"blur"}]},form:{name:"",testSuiteIdList:[],includeForbidden:!1,testEnvId:"",alarmMailList:[],triggerType:"",interval:0,runDate:"",description:""},initForm:{name:"",testSuiteIdList:[],includeForbidden:!1,testDomain:"",alarmMailList:[],triggerType:"",interval:0,runDate:"",description:""},pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}}}},methods:{getTestEnvList:function(){var t=this,e=this,r={status:!0,projectId:e.$route.params.project_id};Object(o.c)(e.$route.params.project_id,r,{}).then(function(r){var i=r.status,s=r.data;"ok"===i?t.testEnvs=s.rows:e.$message.error({message:s,center:!0})}).catch(function(t){e.$message.error({message:"暂时无法获取环境列表，请稍后刷新重试~",center:!0})})},checkActiveTestEnv:function(){this.testEnvs.length<1&&this.$message.warning({message:"未找到「启用的测试环境」哦, 请前往「环境配置」进行设置",center:!0})},getMailList:function(){this.listLoading=!0;var t=this,e={size:t.size,skip:t.skip,sortBy:t.sortBy,order:t.order,projectId:t.$route.params.project_id};""!==t.filters.name.trim()&&(e.name=t.filters.name.trim()),Object(l.b)(this.$route.params.project_id,e).then(function(e){var r=e.status,i=e.data;t.listLoading=!1,"ok"===r?(t.totalNum=i.totalNum,t.mailList=i.rows):t.$message.error({message:i,center:!0})}).catch(function(e){t.$message.error({message:"邮箱列表获取失败，请稍后刷新重试哦~",center:!0}),t.listLoading=!1})},checkActiveMail:function(){this.mailList.length<1&&this.$message.warning({message:"未找到「启用的邮箱」哦, 请前往「邮箱配置」进行设置",center:!0})},getTestSuiteList:function(){var t=this,e={skip:t.skip,size:t.size,sortBy:t.sortBy,order:t.order,projectId:t.$route.params.project_id};this.listLoading=!0,""!==t.filters.name.trim()&&(e.name=t.filters.name.trim());Object(n.d)(t.$route.params.project_id,e,{}).then(function(e){t.listLoading=!1;var r=e.status,i=e.data;"ok"===r?(t.testSuites=i.rows,t.totalNum=i.totalNum):t.$message.error({message:i,center:!0})}).catch(function(e){t.$message.error({message:"用例列表获取失败，请稍后刷新重试哦~",center:!0}),t.listLoading=!1})},checkActiveTestSuite:function(){this.testSuites.length<1&&this.$message.warning({message:"未找到「启用的测试用例组」哦, 请前往「自动化测试」进行设置",center:!0})},queryCronJobs:function(t){var e=this;""!==e.filters.name.trim()&&(t.name=e.filters.name.trim());(function(t,e,r){return Object(a.a)({url:"/api/project/"+t+"/cronJobList",method:"GET",headers:r,params:e})})(e.$route.params.project_id,t,{}).then(function(t){e.listLoading=!1;var r=t.status,i=t.data;"ok"===r?(e.totalNum=i.totalNum,e.cronJobs=i.rows):e.$message.error({message:i,center:!0})}).catch(function(t){e.$message.error({message:"定时任务列表获取失败，请稍后刷新重试哦~",center:!0}),e.listLoading=!1})},getCronJobList:function(){this.listLoading=!0;var t={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id};this.queryCronJobs(t)},handleSizeChange:function(t){this.size=t,this.listLoading=!0;var e={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id};this.queryCronJobs(e)},handleCurrentChange:function(t){this.skip=(t-1)*this.size,this.listLoading=!0;var e={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id};this.queryCronJobs(e)},handleDel:function(t,e){var r=this;this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(function(){r.listLoading=!0;var t=r;(function(t,e,r,i){return Object(a.a)({url:"/api/project/"+t+"/deleteCronJob/"+e,method:"POST",headers:i,data:r})})(r.$route.params.project_id,e._id,{},{}).then(function(e){var r=e.status,i=e.data;"ok"===r?t.$message.success({message:i,center:!0}):t.$message.error({message:i,center:!0}),t.getCronJobList()})})},selectsChange:function(t){t.length>0?(this.selects=t,this.update=!1):this.update=!0},stringToDate:function(t,e){e||(e="-");var r=t.toString().split(e),i=parseInt(r[0]),s=void 0;s=0==r[1].indexOf("0")?parseInt(r[1].substring(1)):parseInt(r[1]);var a=parseInt(r[2]);return new Date(i,s-1,a)},handleEdit:function(t,e){this.formVisible=!0,e.runDate&&e.runDate.constructor===String&&(e.runDate=this.stringToDate(e.runDate)),this.form=s()({},this.form,e),this.dialogStatus="edit"},handleAdd:function(){this.formVisible=!0,this.form=s()({},this.form,this.initForm),this.dialogStatus="add"},submit:function(){var t=this;this.$refs.form.validate(function(e){var r=t;e&&(r.form.runDate&&""!==r.form.runDate.toString().trim()||r.form.interval&&""!==r.form.interval.toString().trim()?"date"===r.form.triggerType&&r.form.runDate<Date.now()?r.$message.warning({message:"人生不能重来哦 ~ 请输入「此刻」以后的日期",center:!0}):t.$confirm("确认提交吗？","提示",{}).then(function(){r.editLoading=!0;var e={"Content-Type":"application/json"};if("add"==t.dialogStatus){var i={name:r.form.name.trim(),testSuiteIdList:r.form.testSuiteIdList,testEnvId:r.form.testEnvId,includeForbidden:r.form.includeForbidden,triggerType:r.form.triggerType,description:r.form.description.trim(),alarmMailList:r.form.alarmMailList,createUser:r.$store.getters.email||"anonymous"};r.form.runDate&&""!==r.form.runDate.toString().trim()&&(i.runDate=r.form.runDate),r.form.interval&&""!==r.form.interval.toString().trim()&&(i.interval=Number(r.form.interval)),function(t,e,r){return Object(a.a)({url:"/api/project/"+t+"/addCronJob",method:"POST",headers:r,data:e})}(r.$route.params.project_id,i,e).then(function(t){r.editLoading=!1;var e=t.status,i=t.data;"ok"===e?(r.formVisible=!1,r.$message.success({message:"添加成功",center:!0}),r.$refs.form.resetFields(),r.formVisible=!1,r.getCronJobList()):(r.formVisible=!1,r.$message.error({message:i,center:!0}),r.$refs.form.resetFields(),r.formVisible=!1,r.getCronJobList())})}else if("edit"==t.dialogStatus){var s={name:r.form.name.trim(),testSuiteIdList:r.form.testSuiteIdList,testEnvId:r.form.testEnvId,includeForbidden:r.form.includeForbidden,triggerType:r.form.triggerType,description:r.form.description.trim(),alarmMailList:r.form.alarmMailList,lastUpdateUser:r.$store.getters.email||"anonymous"};r.form.runDate&&""!==r.form.runDate.toString().trim()&&(s.runDate=r.form.runDate),r.form.interval&&""!==r.form.interval.toString().trim()&&(s.interval=Number(r.form.interval)),function(t,e,r,i){return Object(a.a)({url:"/api/project/"+t+"/updateCronJob/"+e,method:"POST",headers:i,data:r})}(r.$route.params.project_id,r.form._id,s,e).then(function(t){r.editLoading=!1;var e=t.status,i=t.data;"ok"===e?(r.formVisible=!1,r.$message.success({message:"更新成功",center:!0}),r.$refs.form.resetFields(),r.formVisible=!1,r.getCronJobList()):(r.formVisible=!1,r.$message.error({message:i,center:!0}),r.$refs.form.resetFields(),r.formVisible=!1,r.getCronJobList())})}}):"interval"===r.form.triggerType?r.$message.warning({message:"请输入触发间隔",center:!0}):"date"===r.form.triggerType&&r.$message.warning({message:"请输入具体日期",center:!0}))})},sortChange:function(t){this.listLoading=!0,this.sortBy=t.prop,this.order=t.order;var e={size:this.size,skip:this.skip,sortBy:this.sortBy,order:this.order,projectId:this.$route.params.project_id};this.queryCronJobs(e)},handleChangeStatus:function(t,e){var r=this;r.statusChangeLoading=!0;var i={},s={updateUser:r.$store.getters.email};console.log(e.status),"PAUSED"!==e.status?function(t,e,r,i){return Object(a.a)({url:"/api/project/"+t+"/pauseCronJob/"+e,method:"POST",headers:i,data:r})}(r.$route.params.project_id,e._id,s,i).then(function(t){r.statusChangeLoading=!1;var e=t.status,i=t.data;"ok"===e?r.$message.success({message:i,center:!0}):r.$message.error({message:i,center:!0}),r.getCronJobList()}).catch(function(t){r.$message.error({message:"定时任务状态变更失败，请稍后刷新重试哦~",center:!0}),r.statusChangeLoading=!1}):function(t,e,r,i){return Object(a.a)({url:"/api/project/"+t+"/resumeCronJob/"+e,method:"POST",headers:i,data:r})}(r.$route.params.project_id,e._id,s,i).then(function(t){r.statusChangeLoading=!1;var e=t.status,i=t.data;"ok"===e?r.$message.success({message:i,center:!0}):r.$message.error({message:i,center:!0}),r.getCronJobList()}).catch(function(t){r.$message.error({message:"定时任务状态变更失败，请稍后刷新重试哦~",center:!0}),r.statusChangeLoading=!1,r.getCronJobList()})},triggerTypeChange:function(t){"interval"===t?this.form.runDate="":"date"===t&&(this.form.interval="")},reportRowStyle:function(t){var e=t.row;t.rowIndex;return"PAUSED"===e.status?"background-color: #DDDDDD":""},ReportTableRow:function(t){t.row,t.rowIndex;return"reportTableRow"}},created:function(){this.getTestEnvList(),this.getCronJobList(),this.getMailList(),this.getTestSuiteList()}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticStyle:{margin:"10px 35px"}},[i("strong",{staticClass:"title"},[t._v(t._s(t.$route.meta.title))]),t._v(" "),i("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[i("el-form",{attrs:{inline:!0,model:t.filters},nativeOn:{submit:function(t){t.preventDefault()}}},[i("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:""}},[i("el-button",{staticClass:"return-list",on:{click:function(e){return t.$router.back(-1)}}},[i("i",{staticClass:"el-icon-d-arrow-left",staticStyle:{"margin-right":"5px"}}),t._v("返回\n        ")])],1),t._v(" "),i("el-form-item",{staticStyle:{"margin-left":"35px"}},[i("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v(" 新增定时任务")])],1),t._v(" "),i("div",{staticStyle:{float:"right","margin-right":"100px"}},[i("el-form-item",[i("el-input",{attrs:{placeholder:"名称"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getCronJobList(e)}},model:{value:t.filters.name,callback:function(e){t.$set(t.filters,"name","string"==typeof e?e.trim():e)},expression:"filters.name"}})],1),t._v(" "),i("el-form-item",[i("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:t.getCronJobList}},[t._v(" 查询")])],1)],1)],1)],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"row-style":t.reportRowStyle,"row-class-name":t.ReportTableRow,data:t.cronJobs,"highlight-current-row":""},on:{"sort-change":t.sortChange,"selection-change":t.selectsChange}},[i("el-table-column",{attrs:{type:"selection","min-width":"5%"}}),t._v(" "),i("el-table-column",{attrs:{prop:"_id",label:"任务ID","min-width":"20%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"name",label:"任务名称","min-width":"30%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"description",label:"描述","min-width":"20%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"createAt",label:"创建时间","min-width":"25%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{sortable:"custom",prop:"createUser",label:"创建者","min-width":"15%","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"lastUpdateTime",label:"更新时间","min-width":"25%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"lastUpdateUser",label:"更新者","min-width":"15%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"next_run_time",label:"next执行时间","min-width":"25%",sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"10%"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("img",{directives:[{name:"show",rawName:"v-show",value:"PAUSED"!==e.row.status,expression:"scope.row.status!=='PAUSED'"}],attrs:{src:r("7shL")}}),t._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:"PAUSED"===e.row.status,expression:"scope.row.status==='PAUSED'"}],attrs:{src:r("IT+J")}})]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"操作","min-width":"50%"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){return t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){return t.handleDel(e.$index,e.row)}}},[t._v("删除")]),t._v(" "),i("el-button",{attrs:{type:"info",size:"small",loading:t.statusChangeLoading},on:{click:function(r){return t.handleChangeStatus(e.$index,e.row)}}},[t._v("\n          "+t._s("PAUSED"===e.row.status?"启动":"停用")+"\n        ")])]}}])})],1),t._v(" "),i("el-dialog",{staticStyle:{width:"65%",left:"17.5%"},attrs:{title:t.titleMap[t.dialogStatus],visible:t.formVisible,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(e){t.formVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[i("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"用例组",prop:"testSuiteIdList"}},[i("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",multiple:"","auto-complete":"off"},on:{"visible-change":t.checkActiveTestSuite},model:{value:t.form.testSuiteIdList,callback:function(e){t.$set(t.form,"testSuiteIdList",e)},expression:"form.testSuiteIdList"}},t._l(t.testSuites,function(t,e){return i("el-option",{key:e+"",attrs:{label:t.name,value:t._id}})}),1),t._v(" "),i("el-checkbox",{staticStyle:{"margin-left":"50px"},attrs:{label:"是否执行禁用的用例(组)"},model:{value:t.form.includeForbidden,callback:function(e){t.$set(t.form,"includeForbidden",e)},expression:"form.includeForbidden"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"测试环境",prop:"testEnvId"}},[i("el-select",{attrs:{clearable:"","auto-complete":"off"},on:{"visible-change":t.checkActiveTestEnv},model:{value:t.form.testEnvId,callback:function(e){t.$set(t.form,"testEnvId",e)},expression:"form.testEnvId"}},t._l(t.testEnvs,function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t._id}})}),1)],1),t._v(" "),i("el-form-item",{attrs:{label:"触发类型",prop:"triggerType"}},[i("el-select",{attrs:{clearable:"","auto-complete":"off"},on:{change:t.triggerTypeChange},model:{value:t.form.triggerType,callback:function(e){t.$set(t.form,"triggerType","string"==typeof e?e.trim():e)},expression:"form.triggerType"}},t._l(t.TriggerTypes,function(t,e){return i("el-option",{key:e+"",attrs:{label:t.name,value:t.value}})}),1)],1),t._v(" "),i("transition",{attrs:{name:"el-zoom-in-top"}},["interval"===t.form.triggerType.toString()||"date"===t.form.triggerType.toString()?i("div",{staticClass:"form-item-sub form-item-short"},[i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"interval"===t.form.triggerType.toString(),expression:"form.triggerType.toString()==='interval'"}],attrs:{label:"间隔/秒",prop:"interval"}},[i("el-input",{staticStyle:{width:"50%"},attrs:{type:"number","auto-complete":"off"},model:{value:t.form.interval,callback:function(e){t.$set(t.form,"interval","string"==typeof e?e.trim():e)},expression:"form.interval"}})],1),t._v(" "),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"date"===t.form.triggerType.toString(),expression:"form.triggerType.toString()==='date'"}],attrs:{label:"具体日期",prop:"runDate"}},[i("el-date-picker",{attrs:{"picker-options":t.pickerOptions,type:"datetime",placeholder:"请选择触发日期"},model:{value:t.form.runDate,callback:function(e){t.$set(t.form,"runDate","string"==typeof e?e.trim():e)},expression:"form.runDate"}})],1)],1):t._e()]),t._v(" "),i("el-form-item",{attrs:{label:"告警邮箱",prop:"alarmMailList"}},[i("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",multiple:"",placeholder:"请选择告警报告接受者(可多选)"},on:{"visible-change":t.checkActiveMail},model:{value:t.form.alarmMailList,callback:function(e){t.$set(t.form,"alarmMailList",e)},expression:"form['alarmMailList']"}},t._l(t.mailList,function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.email}})}),1)],1),t._v(" "),i("el-form-item",{attrs:{label:"任务描述",prop:"description"}},[i("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(e){t.formVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"primary",loading:t.editLoading},nativeOn:{click:function(e){return t.submit(e)}}},[t._v("提交")])],1)],1),t._v(" "),i("el-col",{staticClass:"toolbar",attrs:{span:24}},[i("el-pagination",{staticStyle:{float:"right"},attrs:{"page-sizes":[10,20,40],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.totalNum},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var u=r("VU/8")(m,c,!1,function(t){r("F83Z")},"data-v-4569c318",null);e.default=u.exports}});
//# sourceMappingURL=7.4b53ffd922a2b9146822.js.map